@page "/Alle_Lokaler"
@using ClientApp.Service
@using Core.Models
<h3>Alle Lokaler</h3>

<ul class="list-group">
    
    <li class="list-group-item d-flex justify-content-between align-items-center fw-bold bg-light">
        <div>Lokalenavn</div>
        <div>Lokation</div>
        <div>Åbningstid</div>
        <div>Bemanding</div>
        <div>Adgang</div>
        <div></div>
    </li>
    
    @foreach (var lokale in lokalelist)
    {
        <li class="list-group-item d-flex justify-content-between align-items-center">
            <div class="fw-bold">@lokale.Name</div>
            <div>@lokale.Location</div>
            <div>@lokale.Åbningstid</div>
            <div>@lokale.Bemanding</div>
            <div>@lokale.Adgang</div>
            
            <button class="btn btn-sm btn-primary" 
                    @onclick="() => OpenModal(lokale)">
                Opdater
            </button>

          
        </li>
    }
</ul>

@if (showModal)
{
    <div class="modal d-block" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Opdater Åbningstid</h5>
                    <button class="btn-close" @onclick="CloseModal"></button>
                </div>
                <div class="modal-body">
                    <label>Fra:</label>
                    <InputSelect @bind-Value="openFrom">
                        @foreach (var cat in åbningstidcategories)
                        {
                            <option value="@cat">@cat</option>
                        }
                    </InputSelect>

                    <label class="mt-2">Til:</label>
                    <InputSelect @bind-Value="openTo">
                        @foreach (var cat in åbningstidcategories)
                        {
                            <option value="@cat">@cat</option>
                        }
                    </InputSelect>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" @onclick="CloseModal">Cancel</button>
                    <button class="btn btn-primary" @onclick="SaveOpeningHours">Save</button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    
    [Inject] private ILokaler lokaleService { get; set; }
    
    private List<Lokale> lokalelist = new List<Lokale> { new Lokale() };
    
    private bool showModal = false;
    private Lokale selectedLokale;
    private string openFrom = "08:00";
    private string openTo = "16:00";
    
    List<string> åbningstidcategories = Enumerable
        .Range(0, 24)              // 0..23
        .Select(h => $"{h:00}:00") // format as "HH:00"
        .ToList();


    private void OpenModal(Lokale lokale)
    {
        selectedLokale = lokale;
        showModal = true;
    }

    private void CloseModal()
    {
        showModal = false;
    }

    private async Task SaveOpeningHours()
    {
        if (selectedLokale != null)
        {
            string newTime = $"{openFrom} - {openTo}";
            selectedLokale.Åbningstid = newTime;
            await lokaleService.UpdateTime(selectedLokale, newTime);
        }

        CloseModal();
    }
    
    protected override async Task OnInitializedAsync()
    {
        lokalelist = await lokaleService.GetAll();
        //keys = await FileService.GetAllKeys();
        foreach (var VARIABLE in lokalelist)
        {
            Console.WriteLine(VARIABLE.Åbningstid);
        }
    }
}